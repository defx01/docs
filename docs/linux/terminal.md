# Терминал

::: warning
Документ на стадии форматирования
:::

`man -k [word]` - найти список команд по ключевому слову (man → manual, -k → keyword)

`info [command]` - информация о команде

`whatis [command]` - краткая информация о команде

`whereis [command]` - где находится файл команды

`locate []` - ищет системные и запускаемые файлы

`ps` – Выводит текущие запущенные процессы

`ps -aux [username] | grep [username]` - показать процессы пользователя

`Ctrl+C` - закрыть процесс

`Ctrl+Z` - оставить процесс в фоне

`fg` - вернуться к фоновому процессу

`su [user]` - переключиться на пользователя

`su -` - переключиться на пользователя root со сменой окружения

`sudo adduser [user] sudo` - добавить пользователя в группу суперпользователей

`sudo apt-get update -y` - обновить зависимости репозиториев (-y → yes)

`uptime` - сведения об аптайме сервера, нагрузке (LA) и пользователях

`uname -a` - сведения о системе (-a → all)

`lscpu` - информация о процессоре

`clear` -

`ls [-l] [-la]` - (-l → отобразить файлы таблицей, -la → и скрытые директории)

`cd [path] [..]` - перейти в указанный каталог (.. → в каталог выше)

`cp` - копировать

`echo $PATH` - вывести значение переменной окружения PATH

`pwd` - показать путь до текущей директории

`touch [file]` - создать файл или обновить дату изменения файла/папки

`cat [file]` - показать содержимое файла

`more [file]` - содержимое файла кусками

`less [file]` - чтение файла с поиском и навигацией

`cp [from] [to]` - скопировать файл(ы)/папку

`cp file*.* [to]` - скопировать файлы по маске

`cp file?.txt [to] -v` - ? → значит один знак (-v → verbose - показывать детали копирования)

`cp -R [dir_from] [dir_to]` - рекурсивно скопировать файлы из одной директории в другую

`mkdir -p [name/name]` - создать папку (-p → если нужно создать вложенные папки)

`mv [file] [new_name]` - переименовать файл или папку (по сути это перенос файла/папки, мы можем перенести в другую папку при этом поменяв название, в данном примере мы просто помещаем файл/папку сюда же с другим названием)

`rmdir [folder]` - стереть папку, если она пустая

`rm -r -f [path/*]` - стереть файлы/папки (-r → ркурсивно, -f → принудительно)

`ln -s [полный-путь-до-папки/файла] [куда поместить линк]` - создает символическую ссылку (ярлык)

`ln [file_from] [file_to]` - полный дубликат файла, при изменении одного, будет меняться и другой

`find [dir] -name "*.txt"` - поиск файла по имени в директории dir (ищет рекурсивно)

`wc [file]` - покажет сколько строк, слов, символов и байт в файле (-l, -w, -m, -c)

`sort [file]` - отсортирует содержимое файла как строки (-n → как числа)

`cut -d "[delimiter]" -f [field_number] [file] | [command]` - разбить строки файла с помощью делимитера и вывести поле под номером field_number в файле file (дополнительно через вертикальную линию можно бросить команду для обработки результата, например sort)

## grep & regulat expressions

`grep linux test.txt` - найти в одном файле слово linux

`grep -i linux ./*` - поиск во всех файлах текущей директории содержимого "linux" (-i → case insensitive)

`grep -rin [text] [dir/file]` - найти текст в файлах (-r → ркурсивно, -i → не учитывать регистр букв, -n - выводить строки)

-l → просто покажет имена файлов, в которых есть нужное вхождение

-с → тоже что l плюс количество вхожений в каждом файле

-w → точное вхождение слова в файле

-A 2 → (after) отобразить две строки после найденного вхождения

-B → то же самое, только до (before)

-C → A & B вместе

`rg -i [text] ~/Ddocuments/*.php` - продвинутый grep, выводит более приятный интерфейс поиска, пропускает бинарники, учитывает .gitignore (необходимо установить ripgrep)

`[some command] | grep [text]` - отфильтровать вывод команды через grep

`grep -P "[regexp]" [file] ` - поиск по регулярному выражению (-P → perl совместимая регулярка)

`grep -Pf patterns.txt [search_file]` - поиск по группе регулярных выражений лежащих в файле patterns.txt (флаг -f)

`[command] > result.txt` - угловая скобка указывает куда сохранить результаты команды

## --

`virtualenv venv` - создание виртуального окружения

`source venv/bin/activate` - активировать вирт окружение

## Псевдонимы

`nano ~/.bashrc` - открываем нужный файл

Опускаемся в самый низ и пишем алиасы:
`alias sv="source venv/bin/activate"`

## mysql

`sudo apt-get install mysql-server mysql-client`

`sudo systemctl stop mysql
sudo apt-get remove --purge mysql-server mysql-client mysql-common
sudo apt-get autoremove
sudo apt-get autoclean
sudo rm -rf /var/lib/mysql
sudo rm -rf /etc/mysql`

## cron

`crontab -l` - посмотреть список задач

`crontab -e` - отредактировать задачи

`crontab -r` - удалить все задачи

`*/15 3,6 8-12 * * echo 'Cron' >> /home/ubuntu22/Desktop/tmp.txt` - Порядок: минуты, часы, день месяца, месяц, день недели (0-6 вс-сб). Через слэш каждые 15, через запятую конкретные, через дефис интервал. Что значит эта запись: каждые 15 минут в 3 и 6 часов с 8 по 12 число месяца записывать слово Cron в файл tmp.txt. Можно в гугле проверять через crontab validator

## Направление ввода / вывода

`sort names.txt > names_sorted.txt` - записать реузультаты сортировки в файл, файл будет перезаписан

`sort -n numbers.txt >> names_sorted.txt` - дозаписать данные в файл

Важно: не используйте конструкцию `sort names.txt > names.txt` - она сотрет файл, потому что сначала терминал создаст файл и только потом начнет работать с его данными.

`sort --output=test.txt test.txt` - перезаписать файл своими же данными

`> file.txt` - обнулить файл

`grep sometext /etc/* 2> error.txt` - неудачное выполнение потока запишет ошибки в файл

`grep sometext /etc/* 2> /dev/null` - покажет только удачне варианты выполнения, а неудачные отправит в никуда

`grep sometext /etc/* > success.txt 2> fail.txt` - распределить вывод по файлам

`grep sometext /etc/* &> result.txt` - сохранить все результаты в файл

## Архивирование tar,gzip,bzip2,zip,xz

`tar cvf [name.tar]` - рекурсивно запаковать файл(ы) (c → create, v → verbose, f → file всегда должен быть в конце)

`tar tf [archive.tar]` - посмотреть, что есть внутри архива

`tar xvf [name.tar]` - разархивировать

`gzip bzip2 xz [file]` - запакует только один файл

`gunzip bunzip2 unxz [file]` - распаковать

`tar cvzf archive.gz [file]` - запаковать файл с компрессией (z - gzip, j - bzip2, J - xz)

`zip -r [archive.zip] [file/folder]` - запаковать в зип

`unzip [archive.zip]` - распаковать

## Пользователи

`cat /etc/passwd` - просмотреть пользователей (username:x:userid:groupid:info:homedir:shell), x - пароль лежит в другом файле

`sudo cat /etc/shadow` - посмотреть пароли (зашифрованы, их никак не узнать), (username:password:сколько дней прошло со дня смены пароля:когда можно поменять пароль:когда нужно обязать поменять пароль:...)

`cat /etc/group` - посмотреть группы пользователей (username:x:groupid)

`su [username]` - (switch user), переключить пользователя

`whoami` - показать имя пользователя, под которым ты залогинен

`id [username]` - имя пользователя не обязательно, посмотреть группы и id пользователя

`last` - последние команды пользователей

`who` или `w` - кто залогинен в систему, лучше использовать w - больше информации

`sudo useradd -m [username]` - создать пользователя (-m - создать домашнюю директорию)

`sudo passwd [username]` - сменить пароль пользователя

/etc/skel - директория, из которой копируются все файлы при создании нового пользователя

`sudo userdel [username] -r` - удалить пользователя со всеми его файлами

`sudo groupadd [groupname]` - добавить группу

`sudo groupdel [groupname]` - удалить группу

`sudo usermod -aG [groupname] [username]` - добавить пользователя в группу (-a - append, G - group)

`sudo gpasswd -a [username] [groupname]` - добавить пользователя в группу (-a - append)

`sudo gpasswd -d [username] [groupname]` - удалить пользователя из группы (-d - delete)

## Права доступ

Первый символ:
* "-" - файл
* "d" - директория
* "l" - ссылка/линк

Далее 3 группы по 3 символа rwx (read, write, execute), если буквы нет, будет знак минуса:
* Первая группа относится к пользователю файла/папки
* Вторая к группе пользователя файла/папки
* Третья ко всем остальным пользователям

`sudo chown [username] [file]` - (change owner), сменить владельца файла/папки

`sudo chgrp [groupname] [file]` - (change group), сменить группу владельцев файла/папки

`chmod u+x,g-w,o-r [file]` - изменить права на файл/папку, (u - пользователь, g - группа, o - все остальные), + или - добавляют/удаляют нужные права

`chmod ugo=r [file]` - другой вариант написания (вместо ugo можно использовать a=... - all)

Памятка по цифрам:
* rwx - 7 (4+2+1)
* rw- - 6 (4+2+0)
* r-x - 5 (5+0+1)
* r-- - 4 (4+0+0)
* -wx - 3 (0+2+1)
* -w- - 2 (0+2+0)
* --x - 1 (0+0+1)
* --- - 0 (0+0+0)

`chmod 777 [file]` - задать права через цифры

`chmod o+t [folder]` - только владелец файла сможет стиреть его внутри папки

`chmod 1777 [folder]` или `chmod 0777 [folder]` - включить отключить sticky beat (невозможность удаления чужих файлов)