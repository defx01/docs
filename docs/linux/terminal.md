# Шпаргалка по командам Linux

Если в конце параметра стоит знак вопроса, значит значение может быть пустым.

## Навигация и файлы

### `pwd` - показать текущую директорию

**Флаги:**
- `-P` - показать физический путь (без симлинков)

### `ls [-options?] [path?]` - список файлов

**Флаги:**
- `-a` - показать скрытые файлы
- `-l` - подробный вывод
- `-h` - читаемые размеры
- `-t` - сортировка по времени
- `-r` - обратная сортировка
- `-R` - рекурсивный обход

### `cd [path?]` - смена директории

**Спецсимволы:**
- `~` - домашняя директория
- `..` - на уровень выше
- `-` - предыдущая директория

## Работа с файлами

### `cp [-options?] [source] [dest]` - копирование

**Флаги:**
- `-r` - рекурсивно
- `-i` - подтверждение
- `-v` - подробный вывод
- `-u` - только новые
- `-p` - сохранять атрибуты

### `mv [-options?] [source] [dest]` - перемещение

**Флаги:**
- `-i` - подтверждение
- `-v` - подробный вывод
- `-n` - не перезаписывать

### `rm [-options?] [file]` - удаление

**Флаги:**
- `-r` - рекурсивно
- `-f` - принудительно
- `-i` - подтверждение

### `mkdir [-options?] [dir]` - создать директорию

**Флаги:**
- `-p` - создать родительские
- `-m` - установить права

**Пример:**
```bash
mkdir -pm 750 newdir/subdir
```

## Просмотр и поиск

### `cat [-options?] [file]` - вывод содержимого

**Флаги:**
- `-n` - нумерация строк
- `-b` - нумерация непустых строк
- `-s` - сжать пустые строки

### `grep [-options?] [pattern] [file]` - поиск

**Флаги:**
- `-i` - игнорировать регистр
- `-r` - рекурсивно
- `-n` - номера строк
- `-v` - инвертировать
- `-c` - количество совпадений

## Права

### `chmod [-options?] [mode] [file]` - права доступа

**Синтаксис:**
- `u` владелец, `g` группа, `o` другие
- `+` добавить, `-` убрать, `=` установить
- `r` чтение, `w` запись, `x` выполнение

**Пример:**
```bash
chmod u+x,g-w,o= script.sh
```

### `chown [-options?] [user]:[group] [file]` - владелец

**Флаги:**
- `-R` - рекурсивно
- `-v` - подробно

## Процессы

### `ps [-options?]` - процессы

**Комбинации:**
- `aux` - все процессы
- `-ef` - полный список
- `-u [user]` - процессы пользователя

### `kill [-options?] [pid]` - завершить процесс

**Флаги:**
- `-9` - принудительно
- `-15` - корректно

## Сеть

### `ping [-options?] [host]` - проверка связи

**Флаги:**
- `-c [count]` - количество пакетов
- `-i [interval]` - интервал

### `netstat [-options?]` - сетевая статистика

**Флаги:**
- `-tulnp` - открытые порты
- `-r` - таблица маршрутизации

## Архивация

### `tar [-options?] [file] [path]` - работа с архивами

**Флаги:**
- `-c` - создать
- `-x` - распаковать
- `-v` - подробно
- `-f` - файл
- `-z` - gzip
- `-j` - bzip2

**Пример:**
```bash
tar -czvf backup.tar.gz /path/to/data
```

## Поиск

### `find [path] [-options]` - поиск файлов

**Опции:**
- `-name` - по имени
- `-type` - по типу
- `-mtime` - по времени
- `-size` - по размеру
- `-exec` - выполнить команду

**Пример:**
```bash
find /var -name "*.log" -type f -size +1M
```

## Диски

### `df [-options?]` - информация о FS

**Флаги:**
- `-h` - читаемый формат
- `-T` - тип файловой системы

### `du [-options?] [path]` - использование диска

**Флаги:**
- `-h` - читаемый формат
- `-s` - только итог
- `--max-depth=[N]` - глубина

**Пример:**
```bash
du -h --max-depth=1 /var
```

## Управление пакетами (APT)

### `apt [command] [-options?] [package]` - менеджер пакетов

**Основные команды:**
- `update` - обновить список пакетов
- `upgrade` - обновить установленные пакеты
- `install` - установить пакет
- `remove` - удалить пакет
- `purge` - удалить с конфигами
- `autoremove` - удалить неиспользуемые зависимости
- `search` - поиск пакета
- `show` - информация о пакете

**Флаги:**
- `-y` - автоматическое подтверждение
- `--no-install-recommends` - не устанавливать рекомендуемые пакеты

**Примеры:**
```bash
apt update && apt upgrade -y
apt install -y nginx --no-install-recommends
apt purge firefox
```

### Полезное

`dpkg -l` / `apt list --installed` - список установленных пакетов

## Работа с текстом

### `sed [-options?] 'command' [file]` - потоковый редактор

**Основные команды:**
- `s/pattern/replacement/` - замена
- `/pattern/d` - удаление строк
- `p` - печать

**Флаги:**
- `-i` - редактировать файл на месте
- `-e` - добавить команду

**Примеры:**
```bash
sed -i 's/old/new/g' file.txt
sed '/error/d' logfile
```

### `awk [-options?] 'pattern {action}' [file]` - обработка текста

**Встроенные переменные:**
- `NR` - номер строки
- `NF` - количество полей
- `$0` - вся строка
- `$1` - первое поле

**Примеры:**
```bash
awk '{print $1}' access.log | sort | uniq -c
awk -F: '/root/ {print $1}' /etc/passwd
```

## Системный мониторинг

### `htop [-options?]` - интерактивный мониторинг

**Флаги:**
- `-d [delay]` - задержка обновления
- `-u [user]` - показывать только процессы пользователя

### `journalctl [-options?]` - просмотр журналов systemd

**Флаги:**
- `-f` - следить за новыми записями
- `-u [unit]` - фильтр по юниту
- `--since [time]` - фильтр по времени
- `-p [priority]` - фильтр по приоритету

**Примеры:**
```bash
journalctl -f -u nginx
journalctl --since "1 hour ago" -p err
```

## SSH и безопасность

### `ssh [-options?] [user@]host [command]` - удаленное подключение

**Флаги:**
- `-p [port]` - указать порт
- `-i [keyfile]` - указать ключ
- `-X` - включить X11 forwarding
- `-L` - локальный портфорвардинг
- `-R` - удаленный портфорвардинг

**Примеры:**
```bash
ssh -p 2222 -i ~/.ssh/id_rsa user@example.com
ssh -L 8080:localhost:80 gateway.example.com
```

### `scp [-options?] [source] [dest]` - безопасное копирование

**Флаги:**
- `-P [port]` - указать порт
- `-i [keyfile]` - указать ключ
- `-r` - рекурсивно

**Примеры:**
```bash
scp -P 2222 -i ~/.ssh/id_rsa file.txt user@example.com:~/backup/
scp -r project/ user@example.com:~/projects/
```

## Разное

### `wget [-options?] [url]` - скачивание файлов

**Флаги:**
- `-O [filename]` - указать имя файла
- `-c` - продолжить прерванную загрузку
- `-q` - тихий режим
- `-r` - рекурсивное скачивание

**Примеры:**
```bash
wget -O archive.zip https://example.com/file.zip
wget -qc https://example.com/largefile.iso
```

### `curl [-options?] [url]` - работа с URL

**Флаги:**
- `-o [file]` - сохранить в файл
- `-O` - сохранить под именем из URL
- `-L` - следовать редиректам
- `-H` - добавить заголовок
- `-d` - отправить данные POST

**Примеры:**
```bash
curl -o page.html https://example.com
curl -H "Authorization: Bearer token" https://api.example.com
```

### `alias [name='command']` - создание псевдонимов

**Примеры:**
```bash
alias ll='ls -lah'
alias update='sudo apt update && sudo apt upgrade'
```

## Cron

`crontab [-options]`

**Флаги:**
- `-l` - посмотреть список задач
- `-e` - отредактировать задачи
- `-r` - удалить все задачи

### Пример записи

`*/15 3,6 8-12 * * echo 'Cron' >> /home/ubuntu/Desktop/tmp.txt`  
(↑ каждые 15 минут в 3 и 6 часов с 8 по 12 число месяца записывать слово Cron в файл tmp.txt ↑)

Порядок: минуты, часы, день месяца, месяц, день недели (0-6 вс-сб)

Через `/` каждые, через запятую конкретные, через дефис интервал

> Можно проверять в гугле через crontab validator

## Полезные комбинации

### Поиск и удаление старых логов:
```bash
find /var/log -name "*.log" -mtime +30 -exec rm -v {} \;
```

### Мониторинг изменений в файлах:
```bash
tail -f /var/log/nginx/access.log | grep ' 500 '
```

### Проверка использования диска:
```bash
du -hx --max-depth=1 / | sort -h
```

### Поиск файлов по содержимому:
```bash
grep -r --include="*.php" "mysql_connect" /var/www/
```

### Быстрое создание бэкапа:
```bash
tar -czvf backup-$(date +%Y%m%d).tar.gz /important/data/
```

## Другое

`sudo update-alternatives --config php` - сменить cli версию php

`which [service]` - узнать, где лежит сервис

`ls -l | grep "txt" | wc -l` - пример пайплайна, где вывод одной команды становится вводом для следующей (через знак `|`)